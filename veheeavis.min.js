!function webpackUniversalModuleDefinition(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.veheeavis=i():t.veheeavis=i()}(this,(()=>(()=>{var t={};const i=(()=>{class Ploteeavis{constructor(t){this.container=document.querySelector(t.container),this.data=t.data,this.styles=t.styles,this.scale=1,this.draggingModule=null,this.startPort=null,this.endPort=null,this.canvas=document.createElement("canvas"),this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.dpr=window.devicePixelRatio||1,this.canvas.style.width=this.container.clientWidth+"px",this.canvas.style.height=this.container.clientHeight+"px",this.canvas.width=this.container.clientWidth*this.dpr,this.canvas.height=this.container.clientHeight*this.dpr,this.ctx.scale(this.dpr,this.dpr),this.view={x:0,y:0,zoom:1},this.validateData(this.data),this.addEventListeners(),this.render()}render(){this.ctx.save(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.translate(this.view.x*this.dpr,this.view.y*this.dpr),this.ctx.scale(this.view.zoom,this.view.zoom),this.data.modules.forEach((t=>{this.drawModule(t),this.drawPorts(t)})),this.data.modules.every((t=>t.leftArray&&t.rightArray&&t.topArray&&t.bottomArray))&&this.data.connections.forEach((t=>{this.drawConnection(t)})),this.startPort&&this.endPort?this.drawTempConnection(this.startPort,this.endPort):this.startPort&&this.drawTempConnectionToMouse(this.startPort,this.mouseX,this.mouseY),this.ctx.restore()}drawPorts(t){const{x:i,y:e,width:o,height:s}=t.position,r=t.leftArray,h=s/(r.length+2),n=6,a=i-3;r.forEach(((o,s)=>{const r=e+(s+1)*h;this.ctx.fillStyle=`rgb(${100*o.portcolor}, 0, 0)`,this.ctx.fillRect(a,r,6,10),o.offsetX=a-i,o.offsetY=r-e,o.width=6,o.height=10;const n=new Rectangle(a,r,6,10);n.port=o,n.module=t,this.portRects.push(n)}));const c=t.rightArray,l=s/(c.length+2),d=6,f=i+o-3;c.forEach(((o,s)=>{const r=e+(s+1)*l;this.ctx.fillStyle=`rgb(${100*o.portcolor}, 0, 0)`,this.ctx.fillRect(f,r,6,10),o.offsetX=f-i,o.offsetY=r-e,o.width=6,o.height=10;const h=new Rectangle(f,r,6,10);h.port=o,h.module=t,this.portRects.push(h)}));const p=t.topArray,u=o/(p.length+2),x=6,y=e-3;p.forEach(((o,s)=>{const r=i+(s+1)*u;this.ctx.fillStyle=`rgb(${100*o.portcolor}, 0, 0)`,this.ctx.fillRect(r,y,10,6),o.offsetX=r-i,o.offsetY=y-e,o.width=10,o.height=6;const h=new Rectangle(r,y,10,6);h.port=o,h.module=t,this.portRects.push(h)}));const m=t.bottomArray,v=o/(m.length+2),w=6,g=e+s-3;m.forEach(((o,s)=>{const r=i+(s+1)*v;this.ctx.fillStyle=`rgb(${100*o.portcolor}, 0, 0)`,this.ctx.fillRect(r,g,10,6),o.offsetX=r-i,o.offsetY=g-e,o.width=10,o.height=6;const h=new Rectangle(r,g,10,6);h.port=o,h.module=t,this.portRects.push(h)}))}validateData(t){const i=t.modules.map((t=>t.name));t.connections.forEach((t=>{if(!i.includes(t.from)||!i.includes(t.to))throw new Error(`Invalid connection: ${t.from} -> ${t.to}`)}))}addEventListeners(){this.portRects=[],this.canvas.addEventListener("mousedown",(t=>{const i=this.getCanvasCoords(t.clientX,t.clientY),e=this.portRects.find((t=>t.contains(i.x,i.y)));e&&(this.startPortRect=e,this.startPort=e.port,this.startPort.module=e.module)})),this.canvas.addEventListener("mousemove",(t=>{const i=this.getCanvasCoords(t.clientX,t.clientY);this.mouseX=i.x,this.mouseY=i.y;const e=this.portRects.find((t=>t.contains(i.x,i.y)));this.canvas.style.cursor=e?"pointer":"",this.startPort&&this.render()})),this.canvas.addEventListener("mouseup",(t=>{if(this.startPort){const i=this.getCanvasCoords(t.clientX,t.clientY),e=this.portRects.find((t=>t.contains(i.x,i.y)));if(e&&(this.endPort=e.port),this.startPort&&this.endPort){const t={from:this.startPortRect.module.name,to:e.module.name,fromPort:this.startPort.portid,toPort:this.endPort.portid};this.data.connections.push(t),this.drawConnection(t),this.startPort=null,this.endPort=null,this.render()}else this.draggingModule=null}})),this.canvas.addEventListener("wheel",(t=>{if(t.ctrlKey){t.preventDefault();const i=this.canvas.getBoundingClientRect(),e=(t.clientX-i.left)/this.dpr,o=(t.clientY-i.top)/this.dpr,s=this.view.zoom;this.view.zoom*=t.deltaY>0?.9:1.1,this.view.zoom=Math.max(.1,Math.min(this.view.zoom,5)),this.view.x-=(e-this.view.x)*(this.view.zoom/s-1),this.view.y-=(o-this.view.y)*(this.view.zoom/s-1),this.render()}}))}getCanvasCoords(t,i){const e=this.canvas.getBoundingClientRect();return{x:(t-e.left-this.view.x)/this.view.zoom,y:(i-e.top-this.view.y)/this.view.zoom}}drawModule(t){const{x:i,y:e,width:o,height:s,color:r}=t.position;this.ctx.fillStyle=r,this.ctx.fillRect(i,e,o,s),this.ctx.strokeStyle="#000",this.ctx.lineWidth=2,this.ctx.strokeRect(i,e,o,s),this.ctx.shadowColor="rgba(0, 0, 0, 0.1)",this.ctx.shadowBlur=10,this.ctx.shadowOffsetX=5,this.ctx.shadowOffsetY=5,this.ctx.fillStyle="#000",this.ctx.font="12px Microsoft YaHei",this.ctx.fillText(t.name,i+10,e+20)}drawPolylineLink(t,i,e,o,s){t.beginPath(),t.moveTo(i,e),t.lineTo(i,e),t.lineTo(o,s),t.lineTo(o,s),t.strokeStyle="black",t.lineWidth=1,t.stroke()}drawPolylineLink_new(t,i,e,o,s,r,h){t.beginPath(),t.moveTo(i,e);const n=undefined;this.calculatePathPoints(i,e,o,s,r,h).forEach((i=>t.lineTo(i.x,i.y))),t.strokeStyle="black",t.lineWidth=1,t.stroke()}calculatePathPoints(t,i,e,o,s,r){const h=[{x:t,y:i}],n=20;switch(s){case"right":h.push({x:t+n,y:i});break;case"left":h.push({x:t-n,y:i});break;case"bottom":h.push({x:t,y:i+n});break;case"top":h.push({x:t,y:i-n})}const a=h[1];let c;switch(r){case"left":c={x:e-n,y:o};break;case"right":c={x:e+n,y:o};break;case"top":c={x:e,y:o-n};break;case"bottom":c={x:e,y:o+n}}return"left"===s||"right"===s?(h.push({x:a.x,y:c.y}),h.push(c)):(h.push({x:c.x,y:a.y}),h.push(c)),h.push({x:e,y:o}),h}drawConnection(t){const i=this.data.modules.find((i=>i.name===t.from)),e=this.data.modules.find((i=>i.name===t.to));if(!i||!e)return;const getPortSide=(t,i)=>t.leftArray.includes(i)?"left":t.rightArray.includes(i)?"right":t.topArray.includes(i)?"top":t.bottomArray.includes(i)?"bottom":void 0,o=i.leftArray.find((i=>i.portid===t.fromPort))||i.rightArray.find((i=>i.portid===t.fromPort))||i.topArray.find((i=>i.portid===t.fromPort))||i.bottomArray.find((i=>i.portid===t.fromPort)),s=e.leftArray.find((i=>i.portid===t.toPort))||e.rightArray.find((i=>i.portid===t.toPort))||e.topArray.find((i=>i.portid===t.toPort))||e.bottomArray.find((i=>i.portid===t.toPort));if(!o||!s)return;const r=getPortSide(i,o),h=getPortSide(e,s),n=i.position.x+o.offsetX+o.width/2,a=i.position.y+o.offsetY+o.height/2,c=e.position.x+s.offsetX+s.width/2,l=e.position.y+s.offsetY+s.height/2;this.drawPolylineLink_new(this.ctx,n,a,c,l,r,h)}drawTempConnection(t,i){const e=t.module.position.x+t.port.offsetX+t.port.width/2,o=t.module.position.y+t.port.offsetY+t.port.height/2,s=i.module.position.x+i.port.offsetX+i.port.width/2,r=i.module.position.y+i.port.offsetY+i.port.height/2;this.ctx.strokeStyle="green",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(e,o),this.ctx.lineTo(s,r),this.ctx.stroke()}drawTempConnectionToMouse(t,i,e){if(!t||!t.module||!t.module.position)return;const o=t.module.position.x+t.offsetX+t.width/2,s=t.module.position.y+t.offsetY+t.height/2;this.ctx.strokeStyle="red",this.ctx.lineWidth=5,this.ctx.beginPath(),this.ctx.moveTo(o,s),this.ctx.lineTo(i,e),this.ctx.stroke()}}class Rectangle{constructor(t,i,e,o){this.x=t,this.y=i,this.width=e,this.height=o}contains(t,i){return t>=this.x&&t<=this.x+this.width&&i>=this.y&&i<=this.y+this.height}}return{Ploteeavis}})();return t})()));